# 传送门视觉效果指南

## 概述

本指南介绍了游戏中传送门的新视觉效果系统，包括美术资源和粒子效果的实现。

## 新增功能

### 1. SVG美术资源

- **文件位置**: `assets/sprites/portal_icon.svg`
- **特点**:
  - 矢量格式，支持无损缩放
  - 内置CSS动画效果
  - 多层光环设计
  - 能量粒子动画
  - 旋转光环效果

### 2. 增强的粒子系统

传送门现在包含三个独立的粒子系统：

#### CoreParticles（核心粒子）
- **数量**: 50个粒子
- **生命周期**: 3秒
- **效果**: 向上流动的蓝色能量流
- **颜色渐变**: 从亮蓝色到透明

#### EnergyParticles（能量粒子）
- **数量**: 25个粒子
- **生命周期**: 2秒
- **效果**: 围绕传送门旋转的白色能量点
- **特点**: 具有角速度，创造旋转效果

#### GlowParticles（光晕粒子）
- **数量**: 15个粒子
- **生命周期**: 4秒
- **效果**: 大型柔和光晕，营造氛围
- **颜色**: 淡蓝色渐变

### 3. 动画效果

#### 空闲状态动画
- **呼吸效果**: 传送门精灵的亮度周期性变化
- **旋转动画**: 8秒完成一圈的缓慢旋转
- **粒子波动**: 粒子数量在30-60之间周期性变化

#### 传送激活动画
- **强烈闪烁**: 多次快速的亮度变化
- **粒子爆发**: 临时增加粒子数量和速度
- **持续时间**: 0.5秒的增强效果

## 技术实现

### 场景结构

```
Portal (Area2D)
├── PortalSprite (Sprite2D) - 使用SVG资源
├── CollisionShape2D - 碰撞检测
└── ParticleSystem (Node2D)
    ├── CoreParticles (CPUParticles2D)
    ├── EnergyParticles (CPUParticles2D)
    └── GlowParticles (CPUParticles2D)
```

### 脚本功能

- `_setup_collision_shape()`: 设置碰撞形状
- `_setup_particle_effects()`: 配置粒子系统的颜色渐变
- `_start_idle_animation()`: 启动空闲状态动画
- `_animate_particles()`: 粒子数量动画
- `_play_teleport_animation()`: 传送激活动画
- `_enhance_particles_for_teleport()`: 传送时的粒子增强

## 使用方法

### 在场景中添加传送门

1. 实例化 `scenes/entities/portal.tscn`
2. 设置传送门位置
3. 配置传送参数（如果需要）：
   - `destination_scene`: 目标场景路径
   - `teleport_position`: 传送到的位置
   - `next_level`: 下一关卡编号

### 测试传送门效果

使用提供的测试场景：
- 文件: `scenes/test_portal.tscn`
- 包含玩家和传送门的简单测试环境
- 可以直接运行查看效果

## 性能考虑

- 使用CPUParticles2D而非GPUParticles2D，适合2D游戏
- 粒子数量经过优化，平衡视觉效果和性能
- SVG资源在导入时转换为纹理，运行时性能良好

## 自定义选项

### 修改粒子效果

在 `_setup_particle_effects()` 函数中可以调整：
- 颜色渐变
- 粒子数量
- 生命周期
- 发射形状

### 修改动画

在 `_start_idle_animation()` 函数中可以调整：
- 呼吸效果的强度和速度
- 旋转速度
- 粒子波动范围

## 故障排除

### 常见问题

1. **传送门不显示**
   - 检查SVG资源是否正确导入
   - 确认场景文件中的资源路径正确

2. **粒子效果不工作**
   - 检查粒子系统节点是否存在
   - 确认粒子的emitting属性为true

3. **动画不流畅**
   - 检查Tween是否正确创建
   - 确认节点引用有效

### 调试技巧

- 使用 `print()` 语句检查节点是否正确获取
- 在编辑器中预览粒子效果
- 使用远程调试器监控性能

## 未来改进

- 添加音效支持
- 实现更多粒子效果变体
- 支持自定义传送门颜色主题
- 添加传送门开启/关闭动画