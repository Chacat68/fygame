# 踩踏击杀功能实现说明

## 功能概述
为角色添加了跳到怪物头顶就击杀怪物的功能，类似于经典平台游戏（如超级马里奥）中的踩踏机制。

## 实现细节

### 玩家端实现 (player.gd)

1. **踩踏检测函数** (`_check_stomp_kill()`)
   - 只有在玩家下落状态（velocity.y > 0）时才能触发踩踏
   - 遍历所有标记为"enemy"组的怪物
   - 检查玩家与怪物的距离（< 25像素）
   - 验证玩家是否在怪物上方（位置检测）

2. **踩踏执行函数** (`_perform_stomp_kill()`)
   - 给玩家向上的反弹力（velocity.y = -250）
   - 重置跳跃次数，允许连续踩踏跳跃
   - 调用怪物的死亡函数
   - 播放击杀音效（power_up音效）

### 怪物端优化 (slime.gd)

1. **组标记**
   - 在`_ready()`函数中将怪物添加到"enemy"组
   - 便于玩家端统一检测和处理

2. **移除旧系统**
   - 移除了原有的头部碰撞检测区域创建
   - 移除了头部碰撞处理函数
   - 简化了代码结构，提高性能

## 游戏机制特点

1. **精确检测**：使用距离和位置双重检测，确保踩踏判定准确
2. **连续跳跃**：踩踏成功后重置跳跃次数，允许连续踩踏多个怪物
3. **反弹效果**：踩踏后给玩家向上的推力，增加游戏手感
4. **音效反馈**：播放击杀音效，提供听觉反馈
5. **一次一个**：每次物理帧只能击杀一个怪物，避免同时击杀多个

## 使用方法

1. 玩家跳跃到怪物上方
2. 确保玩家正在下落（向下移动）
3. 当玩家脚部接触怪物头部区域时，自动触发击杀
4. 玩家获得向上反弹，可以继续跳跃或踩踏其他怪物

## 技术优势

- **性能优化**：使用组查找替代物理查询，减少计算开销
- **代码简洁**：移除复杂的碰撞区域创建，使用简单的距离和位置计算
- **易于扩展**：可以轻松为不同类型的怪物添加踩踏击杀功能
- **调试友好**：清晰的逻辑结构，便于调试和修改参数

## 参数调整

可以通过修改以下参数来调整踩踏机制：
- 检测距离：`distance < 25`
- 反弹力度：`velocity.y = -250`
- 位置容差：`player_bottom >= enemy_top - 5 and player_bottom <= enemy_top + 10`
- 玩家底部偏移：`global_position.y + 8`
- 怪物头顶偏移：`global_position.y - 8`

---

**文档版本**: v1.1  
**最后更新**: 2026年2月  
**维护者**: FyGame 开发团队